<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Jersey Geoguesser</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="geo.css" rel="stylesheet" type="text/css"/>
</head>
<body>
  <div class="background-layer"></div>
  <h1>In New Jersey?</h1>
  <p>Upload a photo and we'll try to guess where in NJ it is.</p>
  <input type="file" id="imageInput" accept="image/*">
  <div id="image-preview"></div>
  <button onclick="analyzeImage()">Try me!</button>


  <script>
    document.addEventListener("DOMContentLoaded", function() {
  const imageInput = document.getElementById("imageInput");
  const preview = document.getElementById("image-preview");
  const results = document.getElementById("results");

  imageInput.addEventListener("change", () => {
      const file = imageInput.files[0];
      if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
              preview.innerHTML = `<img src="${e.target.result}" width="300">`;
          };
          reader.readAsDataURL(file);
      }
  });

  async function analyzeImage() {
      const file = imageInput.files[0];
      if (!file) {
          results.innerHTML = "Try me!";
          return;
      }

      const reader = new FileReader();
      reader.onload = async function (e) {
          const base64Image = e.target.result;
          results.innerHTML = "Analyzing image...";

          try {
              const response = await fetch("http://localhost:5000/analyze", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ imageBase64: base64Image }),
              });

              const data = await response.json();
              results.innerHTML = `Best guess: <strong>${data.location}</strong>`;
          } catch (error) {
              console.error("Error:", error);
              results.innerHTML = "Couldn't reach the AI model.";
          }
      };
      reader.readAsDataURL(file);
  }

  async function getRandomLocation() {
      document.getElementById('suggestion').innerHTML = 'Loading location...';

      try {
          const response = await fetch('http://localhost:5000/random-location');
          const data = await response.json();

          document.getElementById('suggestion').innerHTML = `
              <strong>Go explore:</strong> ${data.location}<br>
              <img src="${data.image_url}" width="150" style="margin-top: 5px;">
          `;
      } catch (error) {
          console.error("Error:", error);
          document.getElementById('suggestion').innerHTML = 'Could not load a location.';
      }
  }

  // Expose functions globally so HTML can access them
  window.analyzeImage = analyzeImage;
  window.getRandomLocation = getRandomLocation;
});
  </script>

  <div id="results"></div>

  <button id="boredButton" style="position: fixed; bottom : 20px; left: 20px;" onclick="getRandomLocation()">
    Bored?
  </button>
  
  <div id="suggestion" style="position: fixed; bottom: 100px; left: 25px; max-width: 200px;"></div>
  
</body>
</html>
